package org.elasticsearch.plugin.readonlyrest.utils;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Map;

import org.elasticsearch.plugin.readonlyrest.oauth.OAuthToken;
import org.junit.Test;

import junit.framework.TestCase;

public class OAuthUtilsTests extends TestCase {
	
	@Test
	public void testExtractFromHeader() {
		String token = "thisisadummytoken";
		String header = "Authorization: Bearer " + token;
		String res = OAuthUtils.extractTokenFromHeader(header);
		assertEquals(token, res);
	}
	
	@Test
	public void testExtractFromHeader2() {
		String token = "eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiJiYThiMmMyNC0wYjZmLTRmODItYTljNi00OTBhYzhlYTQyN2EiLCJleHAiOjE0OTQ4NjE1NDcsIm5iZiI6MCwiaWF0IjoxNDk0ODYwMzQ3LCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiYzI4Yjc0OGItMWY2NC00ZjI2LTg0NzgtODY3MWEzY2RkMWZkIiwiY2xpZW50X3Nlc3Npb24iOiI0YmJmMzU0Yi00ZjdhLTQzNjktODdhMi01YmM2NGVkMWUyOTkiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0.dFkTvE9n4QMlKF0D5JyAF353VYLRfpYQXY9pQqoAFGlQgnyeC9RnTLxCWyLwlgl4S8_6EvKRgDc2TEieDs40h7k6oxDP_b5biYAj95IBvO9Ij72q0vsyATaRwvvx1VkPhhLoxx4gLyxh8fWSt6QoNNP1PQ1VvGKGZ-ehQTXzg_2GM29exQtHisQpM6PgR_I39IGz4uk3OLmLJYmPlLfpLPu2MkhnKW9UCL5MaP0EMMeomhTLa689lR8WPtEJ99ixxGptVD-6EtXBxOSoFrUi317KaCACJgxcrMBWEEkVoS5NMr8D_m-4A3G7_neSicRq4z9Q_48gyD9UUzT6VUfxlg";
		String header = "Authorization: Bearer " + token;
		String res = OAuthUtils.extractTokenFromHeader(header);
		assertEquals(token, res);
	}
	
	@Test
	public void testExtractFromWrongHeader() {
		String token = "eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiJiYThiMmMyNC0wYjZmLTRmODItYTljNi00OTBhYzhlYTQyN2EiLCJleHAiOjE0OTQ4NjE1NDcsIm5iZiI6MCwiaWF0IjoxNDk0ODYwMzQ3LCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiYzI4Yjc0OGItMWY2NC00ZjI2LTg0NzgtODY3MWEzY2RkMWZkIiwiY2xpZW50X3Nlc3Npb24iOiI0YmJmMzU0Yi00ZjdhLTQzNjktODdhMi01YmM2NGVkMWUyOTkiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0.dFkTvE9n4QMlKF0D5JyAF353VYLRfpYQXY9pQqoAFGlQgnyeC9RnTLxCWyLwlgl4S8_6EvKRgDc2TEieDs40h7k6oxDP_b5biYAj95IBvO9Ij72q0vsyATaRwvvx1VkPhhLoxx4gLyxh8fWSt6QoNNP1PQ1VvGKGZ-ehQTXzg_2GM29exQtHisQpM6PgR_I39IGz4uk3OLmLJYmPlLfpLPu2MkhnKW9UCL5MaP0EMMeomhTLa689lR8WPtEJ99ixxGptVD-6EtXBxOSoFrUi317KaCACJgxcrMBWEEkVoS5NMr8D_m-4A3G7_neSicRq4z9Q_48gyD9UUzT6VUfxlg";
		String header = "Authorization: Basic " + token;
		String res = OAuthUtils.extractTokenFromHeader(header);
		assertNotSame(token, res);
	}
	
	@Test
	public void testExtractFromCookie() {
		String token = "thisisadummytoken";
		String cookieName = "datasweet-test";
		String cookie = cookieName + "=" + token;
		String res = OAuthUtils.extractTokenFromCookie(cookie, cookieName);
		assertEquals(token, res);
	}
	
	@Test
	public void testExtractFromCookie2() {
		String token = "eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiJiYThiMmMyNC0wYjZmLTRmODItYTljNi00OTBhYzhlYTQyN2EiLCJleHAiOjE0OTQ4NjE1NDcsIm5iZiI6MCwiaWF0IjoxNDk0ODYwMzQ3LCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiYzI4Yjc0OGItMWY2NC00ZjI2LTg0NzgtODY3MWEzY2RkMWZkIiwiY2xpZW50X3Nlc3Npb24iOiI0YmJmMzU0Yi00ZjdhLTQzNjktODdhMi01YmM2NGVkMWUyOTkiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0.dFkTvE9n4QMlKF0D5JyAF353VYLRfpYQXY9pQqoAFGlQgnyeC9RnTLxCWyLwlgl4S8_6EvKRgDc2TEieDs40h7k6oxDP_b5biYAj95IBvO9Ij72q0vsyATaRwvvx1VkPhhLoxx4gLyxh8fWSt6QoNNP1PQ1VvGKGZ-ehQTXzg_2GM29exQtHisQpM6PgR_I39IGz4uk3OLmLJYmPlLfpLPu2MkhnKW9UCL5MaP0EMMeomhTLa689lR8WPtEJ99ixxGptVD-6EtXBxOSoFrUi317KaCACJgxcrMBWEEkVoS5NMr8D_m-4A3G7_neSicRq4z9Q_48gyD9UUzT6VUfxlg";
		String cookieName = "datasweet-test";
		String cookie = cookieName + "=" + token;
		String res = OAuthUtils.extractTokenFromCookie(cookie, cookieName);
		assertEquals(token, res);
	}
	
	@Test
	public void testExtractFromCookieWrongName() {
		String token = "eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiJiYThiMmMyNC0wYjZmLTRmODItYTljNi00OTBhYzhlYTQyN2EiLCJleHAiOjE0OTQ4NjE1NDcsIm5iZiI6MCwiaWF0IjoxNDk0ODYwMzQ3LCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiYzI4Yjc0OGItMWY2NC00ZjI2LTg0NzgtODY3MWEzY2RkMWZkIiwiY2xpZW50X3Nlc3Npb24iOiI0YmJmMzU0Yi00ZjdhLTQzNjktODdhMi01YmM2NGVkMWUyOTkiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0.dFkTvE9n4QMlKF0D5JyAF353VYLRfpYQXY9pQqoAFGlQgnyeC9RnTLxCWyLwlgl4S8_6EvKRgDc2TEieDs40h7k6oxDP_b5biYAj95IBvO9Ij72q0vsyATaRwvvx1VkPhhLoxx4gLyxh8fWSt6QoNNP1PQ1VvGKGZ-ehQTXzg_2GM29exQtHisQpM6PgR_I39IGz4uk3OLmLJYmPlLfpLPu2MkhnKW9UCL5MaP0EMMeomhTLa689lR8WPtEJ99ixxGptVD-6EtXBxOSoFrUi317KaCACJgxcrMBWEEkVoS5NMr8D_m-4A3G7_neSicRq4z9Q_48gyD9UUzT6VUfxlg";
		String cookieName = "datasweet-test";
		String cookie = cookieName + "=" + token;
		String res = OAuthUtils.extractTokenFromCookie(cookie, "dummy");
		assertNotSame(cookie, res);
	}
	
	@Test
	public void testGetOAuthTokenFromCookie() {
		Map<String, String> headers = new HashMap<>();
		String cookieName = "datasweet-test";
		String token = "Fe26.2**A2E45F99E0F1860665BAEF16FF58BE1E7D0B47E413A61A242DF4A5AD04F92BEB*ZKbyYlYlWuErEajpUyihTA*Qa5gbTL-gd7fOuutnU5VR8ks_cgED1cA3KaL-WAzfCgSvidwzpL8pooeKsxFnJ8VXby4eFI5kCiWNsJuPbPHY4mKBaIEUEAzdivKf65YNAcRbkhWgp8ZHxzPhexTf4ImNKDAykbuCSI3BNmxzU1wlle2c9SGzsMwYjwXht2Q7hYbhnW585PG3MRewfQ5Msknfpphe8ijrVkGYSjreJfcAviRW9vlOaZIb0Pl5cY-hfd2o-CIJV8GNQpr4oF61MO4UKhxc1U2frwx3D0z1XTn_qGkoSAz5fVhAvhMW0AHcX-MYxqxKYxCPucCQSz9NNbc4mkLyfBP9Wx5C3YM0tB48fXKWkI6eh-2adMwIT1j0Eu71MS3Qy2-DMDG7fkIDMEuoAEZNtTApP7cAkfZv39SCS_XfHBPYuJjqKCV3KdtXbjhs419oBRfbiqlqkn8l5f0AYflxeTZCBGhDjZBNazF4xME3KvuKvNYC1BAUnyzBTt4dWtthxSWdt7nZx6b5Az2Y7-7uVyJ4fSMCgf9EfEgNADF1xcQqlYe733QT9iSuSu3LdqiyLJ2u3N-hnqIhHlwGP-3p5cOlHiy_0lEW4BhFOW5GdPyH4w7YzFS0d3s7c1TsUQNJwHpALj7-WpL-vJJUvEWvVe2tFRCMP4yArSAYM1VoFycDjZfR08SSW0TFmWjED6V_oR-sHJgTZAZPnJjm9fPwidHNzKspjsBvProDM7I4ZHJ7iWPJ7evDCSwWSTxeKMA4Q5-daqnS3iiRfTdj3Xgvu7qM1uwxMHbXvUeMl5sDBLZt-VQlOC0JnbZj4_-QKqZzmEzvdQ-Lsg1k0qjnCKXXWBw7VXdXRqEG1ukTCBaYHYkzXFnV6Lbec4_CDkWoopnpxw30Xov5uvFO9UXPz4aNIYtP6bHt2tRftBC32NUuM1q-YANmkIyQ2fg9y0jda2aM0u7TWOYIX4jZ3HF-x0KxSkH_tkD-h6NRrXHfKuGERAQuJc3YgL_0hU8Vf2t_xt_nZNsNSJPAwikhEunkk-g0R89FFeYd1U47TdXH_JXbAt8v7s3o7qOfk9m-E5rLBZjKxYNOdvTTOHvkDkr8wkvMAYWEIxE69ClavxcVGNFoZF9nZB_jnzD5wiQiZelSTwPG_NjwMJijzlyhCDFFS0E18JDsEX78o-YON8G6dmn0xbDW9Din3gLOsMBP2zeZLnGGyYLwb1mkpmQHIWZHrfmJiHwpkEaD3JC0e2knZK2l63hOMZsNvNEvVZX1jJ-xf7svRcgVnP_clmWgZM70ym23KN8lj1QmVM26tdhUtj1tMTGvVMRWMUSGXBAdGqnexAeMsxAuN-kFQiMt5bk6HJxRYGsWfgp51j43RyO7mv1_SUmJ7KGOlcKscjj-0OjFgi6421HkZZlzUrt3-RHvRltBq-YwNU1Ej0x4L8a93lhtI0GknScL_MYRubjt7Ecsz38u4ZvPTh-Td7ma3EYq2xXVb5Q6xsfVs-9-fNuxh1TFZp7OUa0g7-GVaeyz9omu8oyjGpC6gOUbzf6St6pb4oC92cAaNtVvF2pGsdr1vyW0LYE15e9g1rSa2iVqQiXlHSdKzyub7Y64Z9ahGnkbTlBJ1AqlbJ_ri686C4b4oXyKd-br2JVLWAQcewNdy_KJ6GGt8su2tOj0of0dLFpEmw9fg1ObBWj4kAGnIrtEGt3KmDSWVWAUz71XZCvBTEqP7w0SUhN1yadrXJTOFWY4s3smIoR2uTN5sTSWdk6CnqbYEjqJeGRKsEjU4TaLuOQWO_-pN4wWq8fofSY4fQm5Vz1KetY20hCW0sLWlO5bOnacuYTl08go4DXQVmaCCxufoBKNqcRHZr4Mpg35qDHPeS2uCHllAGOxi38OJa5DsoRjoOCVEjyuSWKbmspJWsm5c3-SiyDpFqftwqOg8ZI**A176A10E2290FFDFD17D6109EF609393DBDF601056A358F2EE8B3DA6737A6DE0*mH7l8l_rJcA5qAuQfqiNTq39psw3q_KCIXVYwK2rwrc";
		headers.put("Cookie", cookieName + "=" + token);
		String cookieSecret = "3eeadfea0896c1a51b41d09aa1eab3d6c24d2154";
		String tokenClientId = "demo";
		OAuthToken oauthToken = OAuthUtils.getOAuthToken(headers, cookieName, cookieSecret, tokenClientId, "");
		ArrayList<String> roles = new ArrayList<>();
		roles.add("Viewer");
		roles.add("Admin");
		roles.add("Editor");
		assertEquals("RS256", oauthToken.getAlg());
		assertEquals("", oauthToken.getPublicKey());
		assertEquals("rvibrac", oauthToken.getPreferredUsername());
		assertEquals(roles, oauthToken.getRoles());
		assertEquals("demo", oauthToken.getAud());
		assertEquals("demo", oauthToken.getAzp());
	}
	
	@Test
	public void testGetOAuthTokenFromAuthorizationWrongSecret() {
		Map<String, String> headers = new HashMap<>();
		String cookieName = "datasweet-test";
		String token = "Fe26.2**A2E45F99E0F1860665BAEF16FF58BE1E7D0B47E413A61A242DF4A5AD04F92BEB*ZKbyYlYlWuErEajpUyihTA*Qa5gbTL-gd7fOuutnU5VR8ks_cgED1cA3KaL-WAzfCgSvidwzpL8pooeKsxFnJ8VXby4eFI5kCiWNsJuPbPHY4mKBaIEUEAzdivKf65YNAcRbkhWgp8ZHxzPhexTf4ImNKDAykbuCSI3BNmxzU1wlle2c9SGzsMwYjwXht2Q7hYbhnW585PG3MRewfQ5Msknfpphe8ijrVkGYSjreJfcAviRW9vlOaZIb0Pl5cY-hfd2o-CIJV8GNQpr4oF61MO4UKhxc1U2frwx3D0z1XTn_qGkoSAz5fVhAvhMW0AHcX-MYxqxKYxCPucCQSz9NNbc4mkLyfBP9Wx5C3YM0tB48fXKWkI6eh-2adMwIT1j0Eu71MS3Qy2-DMDG7fkIDMEuoAEZNtTApP7cAkfZv39SCS_XfHBPYuJjqKCV3KdtXbjhs419oBRfbiqlqkn8l5f0AYflxeTZCBGhDjZBNazF4xME3KvuKvNYC1BAUnyzBTt4dWtthxSWdt7nZx6b5Az2Y7-7uVyJ4fSMCgf9EfEgNADF1xcQqlYe733QT9iSuSu3LdqiyLJ2u3N-hnqIhHlwGP-3p5cOlHiy_0lEW4BhFOW5GdPyH4w7YzFS0d3s7c1TsUQNJwHpALj7-WpL-vJJUvEWvVe2tFRCMP4yArSAYM1VoFycDjZfR08SSW0TFmWjED6V_oR-sHJgTZAZPnJjm9fPwidHNzKspjsBvProDM7I4ZHJ7iWPJ7evDCSwWSTxeKMA4Q5-daqnS3iiRfTdj3Xgvu7qM1uwxMHbXvUeMl5sDBLZt-VQlOC0JnbZj4_-QKqZzmEzvdQ-Lsg1k0qjnCKXXWBw7VXdXRqEG1ukTCBaYHYkzXFnV6Lbec4_CDkWoopnpxw30Xov5uvFO9UXPz4aNIYtP6bHt2tRftBC32NUuM1q-YANmkIyQ2fg9y0jda2aM0u7TWOYIX4jZ3HF-x0KxSkH_tkD-h6NRrXHfKuGERAQuJc3YgL_0hU8Vf2t_xt_nZNsNSJPAwikhEunkk-g0R89FFeYd1U47TdXH_JXbAt8v7s3o7qOfk9m-E5rLBZjKxYNOdvTTOHvkDkr8wkvMAYWEIxE69ClavxcVGNFoZF9nZB_jnzD5wiQiZelSTwPG_NjwMJijzlyhCDFFS0E18JDsEX78o-YON8G6dmn0xbDW9Din3gLOsMBP2zeZLnGGyYLwb1mkpmQHIWZHrfmJiHwpkEaD3JC0e2knZK2l63hOMZsNvNEvVZX1jJ-xf7svRcgVnP_clmWgZM70ym23KN8lj1QmVM26tdhUtj1tMTGvVMRWMUSGXBAdGqnexAeMsxAuN-kFQiMt5bk6HJxRYGsWfgp51j43RyO7mv1_SUmJ7KGOlcKscjj-0OjFgi6421HkZZlzUrt3-RHvRltBq-YwNU1Ej0x4L8a93lhtI0GknScL_MYRubjt7Ecsz38u4ZvPTh-Td7ma3EYq2xXVb5Q6xsfVs-9-fNuxh1TFZp7OUa0g7-GVaeyz9omu8oyjGpC6gOUbzf6St6pb4oC92cAaNtVvF2pGsdr1vyW0LYE15e9g1rSa2iVqQiXlHSdKzyub7Y64Z9ahGnkbTlBJ1AqlbJ_ri686C4b4oXyKd-br2JVLWAQcewNdy_KJ6GGt8su2tOj0of0dLFpEmw9fg1ObBWj4kAGnIrtEGt3KmDSWVWAUz71XZCvBTEqP7w0SUhN1yadrXJTOFWY4s3smIoR2uTN5sTSWdk6CnqbYEjqJeGRKsEjU4TaLuOQWO_-pN4wWq8fofSY4fQm5Vz1KetY20hCW0sLWlO5bOnacuYTl08go4DXQVmaCCxufoBKNqcRHZr4Mpg35qDHPeS2uCHllAGOxi38OJa5DsoRjoOCVEjyuSWKbmspJWsm5c3-SiyDpFqftwqOg8ZI**A176A10E2290FFDFD17D6109EF609393DBDF601056A358F2EE8B3DA6737A6DE0*mH7l8l_rJcA5qAuQfqiNTq39psw3q_KCIXVYwK2rwrc";
		headers.put("Cookie", cookieName + "=" + token);
		String cookieSecret = "dummySecret";
		String tokenClientId = "demo";
		OAuthToken oauthToken = OAuthUtils.getOAuthToken(headers, cookieName, cookieSecret, tokenClientId, "");
		assertNull(oauthToken);
	}
	
	@Test
	public void testGetOAuthTokenFromAuthorization() {
		Map<String, String> headers = new HashMap<>();
		String token = "eyJhbGciOiJSUzI1NiJ9.eyJqdGkiOiI2MzQ0NzAzOC1kMjg0LTRiZjMtYWYzMS05NDlmYmUyN2EyNzMiLCJleHAiOjE0OTQ5NDA4MTEsIm5iZiI6MCwiaWF0IjoxNDk0OTM5NjExLCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiOTViZTQ3YjAtYTg2OS00N2ViLWExNTEtZWM1MGQ5OTMwYmExIiwiY2xpZW50X3Nlc3Npb24iOiIyY2EwOWI4MC02NWQ0LTQzOTktOGJjMy1kOTNmMTk4Y2ZiMmYiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0.bhPv2FNRKUXH0f-LnNoiHnzuJnST73bvqXrp6W4ZwG50_vaTy5iVqigPzsKR7Gkq3E3tM8Xh-wbgaY4Mtut9pYVQ7f9HQpZEks02F04gBQFNocjOdl7Jx6nCWEBye4PY3HImPqgKj8iHdzONApKctYdy_kAuTCPgxfvE6asWbfloO6YB3uWBwKrcTuvyuSIBaDjJw06hDfYCZ62QzOuQrY3aXhWVAkzaKriepKcZwBubnriigd8_epNcLlBvdrCo32FCV8FZOXmu9SopkrLaM2xENycGL27A2bBocTfx3tlTmYod4EvCRZKijz7VDZWYVmzksSIyO3tTPkDwhsBS1g";
		headers.put("Authorization", "Bearer " + token);
		String cookieSecret = "3eeadfea0896c1a51b41d09aa1eab3d6c24d2154";
		String tokenClientId = "demo";
		OAuthToken oauthToken = OAuthUtils.getOAuthToken(headers, "", cookieSecret, tokenClientId, "");
		ArrayList<String> roles = new ArrayList<>();
		roles.add("Viewer");
		roles.add("Admin");
		roles.add("Editor");
		assertEquals("RS256", oauthToken.getAlg());
		assertEquals("", oauthToken.getPublicKey());
		assertEquals("rvibrac", oauthToken.getPreferredUsername());
		assertEquals(roles, oauthToken.getRoles());
		assertEquals("demo", oauthToken.getAud());
		assertEquals("demo", oauthToken.getAzp());
	}

	@Test
	public void testVerifyTokenIntegrityNull() {
		boolean res = OAuthUtils.verifyTokenIntegrity(null, null);
		assertFalse(res);
	}
	
	@Test
	public void testVerifyTokenIntegrityWrongKey() {
		OAuthToken token = new OAuthToken();
		token.setHeader("eyJhbGciOiJSUzI1NiJ9");
		token.setPayload("eyJqdGkiOiI2MzQ0NzAzOC1kMjg0LTRiZjMtYWYzMS05NDlmYmUyN2EyNzMiLCJleHAiOjE0OTQ5NDA4MTEsIm5iZiI6MCwiaWF0IjoxNDk0OTM5NjExLCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiOTViZTQ3YjAtYTg2OS00N2ViLWExNTEtZWM1MGQ5OTMwYmExIiwiY2xpZW50X3Nlc3Npb24iOiIyY2EwOWI4MC02NWQ0LTQzOTktOGJjMy1kOTNmMTk4Y2ZiMmYiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0");
		token.setSignature("bhPv2FNRKUXH0f-LnNoiHnzuJnST73bvqXrp6W4ZwG50_vaTy5iVqigPzsKR7Gkq3E3tM8Xh-wbgaY4Mtut9pYVQ7f9HQpZEks02F04gBQFNocjOdl7Jx6nCWEBye4PY3HImPqgKj8iHdzONApKctYdy_kAuTCPgxfvE6asWbfloO6YB3uWBwKrcTuvyuSIBaDjJw06hDfYCZ62QzOuQrY3aXhWVAkzaKriepKcZwBubnriigd8_epNcLlBvdrCo32FCV8FZOXmu9SopkrLaM2xENycGL27A2bBocTfx3tlTmYod4EvCRZKijz7VDZWYVmzksSIyO3tTPkDwhsBS1g");
		token.setAlg("RS256");
		String dummyKey = "dummy";
		boolean res = OAuthUtils.verifyTokenIntegrity(token, dummyKey);
		assertFalse(res);
	}
	
	@Test
	public void testVerifyTokenIntegrityWrongAlgo() {
		OAuthToken token = new OAuthToken();
		token.setHeader("eyJhbGciOiJSUzI1NiJ9");
		token.setPayload("eyJqdGkiOiI2MzQ0NzAzOC1kMjg0LTRiZjMtYWYzMS05NDlmYmUyN2EyNzMiLCJleHAiOjE0OTQ5NDA4MTEsIm5iZiI6MCwiaWF0IjoxNDk0OTM5NjExLCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiOTViZTQ3YjAtYTg2OS00N2ViLWExNTEtZWM1MGQ5OTMwYmExIiwiY2xpZW50X3Nlc3Npb24iOiIyY2EwOWI4MC02NWQ0LTQzOTktOGJjMy1kOTNmMTk4Y2ZiMmYiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0");
		token.setSignature("bhPv2FNRKUXH0f-LnNoiHnzuJnST73bvqXrp6W4ZwG50_vaTy5iVqigPzsKR7Gkq3E3tM8Xh-wbgaY4Mtut9pYVQ7f9HQpZEks02F04gBQFNocjOdl7Jx6nCWEBye4PY3HImPqgKj8iHdzONApKctYdy_kAuTCPgxfvE6asWbfloO6YB3uWBwKrcTuvyuSIBaDjJw06hDfYCZ62QzOuQrY3aXhWVAkzaKriepKcZwBubnriigd8_epNcLlBvdrCo32FCV8FZOXmu9SopkrLaM2xENycGL27A2bBocTfx3tlTmYod4EvCRZKijz7VDZWYVmzksSIyO3tTPkDwhsBS1g");
		token.setAlg("R256");
		String key = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkBpwYFlAqMcQhdbSOkkOHu3cU39EioKzWdmmkD8HZS0vfuiqij/PgqMJvF49EXwiclCLgGmf71pvZxazEHp2sqQmkUYeF9xAUPvRKurNE2krd69g+nGiOCvoNMZ10APeO3FU36EOtn2cxoYXUs/qkNBQZf1YZaI0BfWqjhwI9ndFwbx2D8o4YliGfJdagDJhueJ4X3L++pqfk7f8UYXehmE9T+2ymJPbSkx7Lw9YQFIoRYdWzAfFJebk1v0FUE1mmfTSDEye47UvYxec4StYzo1f1K3SgXwUTl1EuhClH1eX+XAuQYHWczR9sXH3kGAvKFsJ/azVBh0N1M1hs+N97wIDAQAB";
		boolean res = OAuthUtils.verifyTokenIntegrity(token, key);
		assertFalse(res);
	}
	
	@Test
	public void testVerifyTokenIntegrity() {
		OAuthToken token = new OAuthToken();
		token.setHeader("eyJhbGciOiJSUzI1NiJ9");
		token.setPayload("eyJqdGkiOiI2MzQ0NzAzOC1kMjg0LTRiZjMtYWYzMS05NDlmYmUyN2EyNzMiLCJleHAiOjE0OTQ5NDA4MTEsIm5iZiI6MCwiaWF0IjoxNDk0OTM5NjExLCJpc3MiOiJodHRwczovL2RlbW8uYWx0YW5vdmEuZnIvYXV0aC9yZWFsbXMvRGF0YVN3ZWV0IiwiYXVkIjoiZGVtbyIsInN1YiI6IjdjNDIzM2U3LTI3YzMtNDk2Mi04M2FhLTBjMjkxNzRjNmJjMCIsInR5cCI6IkJlYXJlciIsImF6cCI6ImRlbW8iLCJzZXNzaW9uX3N0YXRlIjoiOTViZTQ3YjAtYTg2OS00N2ViLWExNTEtZWM1MGQ5OTMwYmExIiwiY2xpZW50X3Nlc3Npb24iOiIyY2EwOWI4MC02NWQ0LTQzOTktOGJjMy1kOTNmMTk4Y2ZiMmYiLCJhbGxvd2VkLW9yaWdpbnMiOlsiaHR0cHM6Ly9yZWMtdGhvbWFzY29vay5kYXRhc3dlZXQuZnIvIiwiaHR0cDovL2xvY2FsaG9zdDo5MDkwIiwiaHR0cHM6Ly9kZW1vLmFsdGFub3ZhLmZyIiwiaHR0cHM6Ly9sb2NhbGhvc3Q6NTYwMSJdLCJyZWFsbV9hY2Nlc3MiOnsicm9sZXMiOlsidW1hX2F1dGhvcml6YXRpb24iXX0sInJlc291cmNlX2FjY2VzcyI6eyJkZW1vIjp7InJvbGVzIjpbIlZpZXdlciIsIkFkbWluIiwiRWRpdG9yIl19LCJhY2NvdW50Ijp7InJvbGVzIjpbIm1hbmFnZS1hY2NvdW50Iiwidmlldy1wcm9maWxlIl19fSwibmFtZSI6IlJvbWFpbiBWaWJyYWMiLCJwcmVmZXJyZWRfdXNlcm5hbWUiOiJydmlicmFjIiwiZ2l2ZW5fbmFtZSI6IlJvbWFpbiIsImZhbWlseV9uYW1lIjoiVmlicmFjIiwiZW1haWwiOiJyb21haW4udmlicmFjQGFsdGFub3ZhLmZyIn0");
		token.setSignature("bhPv2FNRKUXH0f-LnNoiHnzuJnST73bvqXrp6W4ZwG50_vaTy5iVqigPzsKR7Gkq3E3tM8Xh-wbgaY4Mtut9pYVQ7f9HQpZEks02F04gBQFNocjOdl7Jx6nCWEBye4PY3HImPqgKj8iHdzONApKctYdy_kAuTCPgxfvE6asWbfloO6YB3uWBwKrcTuvyuSIBaDjJw06hDfYCZ62QzOuQrY3aXhWVAkzaKriepKcZwBubnriigd8_epNcLlBvdrCo32FCV8FZOXmu9SopkrLaM2xENycGL27A2bBocTfx3tlTmYod4EvCRZKijz7VDZWYVmzksSIyO3tTPkDwhsBS1g");
		token.setAlg("RS256");
		String key = "MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAkBpwYFlAqMcQhdbSOkkOHu3cU39EioKzWdmmkD8HZS0vfuiqij/PgqMJvF49EXwiclCLgGmf71pvZxazEHp2sqQmkUYeF9xAUPvRKurNE2krd69g+nGiOCvoNMZ10APeO3FU36EOtn2cxoYXUs/qkNBQZf1YZaI0BfWqjhwI9ndFwbx2D8o4YliGfJdagDJhueJ4X3L++pqfk7f8UYXehmE9T+2ymJPbSkx7Lw9YQFIoRYdWzAfFJebk1v0FUE1mmfTSDEye47UvYxec4StYzo1f1K3SgXwUTl1EuhClH1eX+XAuQYHWczR9sXH3kGAvKFsJ/azVBh0N1M1hs+N97wIDAQAB";
		boolean res = OAuthUtils.verifyTokenIntegrity(token, key);
		assertTrue(res);
	}
}